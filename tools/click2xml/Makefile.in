SHELL = @SHELL@
@SUBMAKE@

top_srcdir = @top_srcdir@
srcdir = @srcdir@
top_builddir = ../..
subdir = tools/click2xml
conf_auxdir = @conf_auxdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
HOST_TOOLS = @HOST_TOOLS@

VPATH = .:$(top_srcdir)/$(subdir):$(top_srcdir)/tools/lib:$(top_srcdir)/include

ifeq ($(HOST_TOOLS),build)
CC = @BUILD_CC@
CXX = @BUILD_CXX@
LIBCLICKTOOL = libclicktool_build.a
DL_LIBS = @BUILD_DL_LIBS@
else
CC = @CC@
CXX = @CXX@
LIBCLICKTOOL = libclicktool.a
DL_LIBS = @DL_LIBS@
endif
INSTALL = @INSTALL@
mkinstalldirs = $(conf_auxdir)/mkinstalldirs

.SUFFIXES:
.SUFFIXES: .S .c .cc .o .s

.c.o:
	$(COMPILE) -c $<
.s.o:
	$(COMPILE) -c $<
.S.o:
	$(COMPILE) -c $<
.cc.o:
	$(CXXCOMPILE) -c $<


CLICK2XML_OBJS = click2xml.o
XML2CLICK_OBJS = xml2click.o

CPPFLAGS = @CPPFLAGS@ -DCLICK_TOOL
CFLAGS = @CFLAGS@
CXXFLAGS = @CXXFLAGS@
DEPCFLAGS = @DEPCFLAGS@

DEFS = @DEFS@
INCLUDES = -I$(top_builddir)/include -I$(top_srcdir)/include \
	-I$(top_srcdir)/tools/lib -I$(srcdir) @EXPAT_INCLUDES@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@ @EXPAT_LIBS@ $(DL_LIBS)

CXXCOMPILE = $(CXX) $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CXXFLAGS) $(DEPCFLAGS)
CXXLD = $(CXX)
CXXLINK = $(CXXLD) $(CXXFLAGS) $(LDFLAGS) -o $@
COMPILE = $(CC) $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) $(DEPCFLAGS)
CCLD = $(CC)
LINK = $(CCLD) $(CFLAGS) $(LDFLAGS) -o $@

all: $(LIBCLICKTOOL) all-local
all-local: click2xml @XML2CLICK@

$(LIBCLICKTOOL):
	@cd ../lib; $(MAKE) $(LIBCLICKTOOL)

click2xml: Makefile $(CLICK2XML_OBJS) ../lib/$(LIBCLICKTOOL)
	$(CXXLINK) -rdynamic $(CLICK2XML_OBJS) $(LIBS) ../lib/$(LIBCLICKTOOL)

xml2click: Makefile $(XML2CLICK_OBJS) ../lib/$(LIBCLICKTOOL)
	$(CXXLINK) -rdynamic $(XML2CLICK_OBJS) $(LIBS) ../lib/$(LIBCLICKTOOL)

Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
	cd $(top_builddir) \
	  && CONFIG_FILES=$(subdir)/$@ CONFIG_ELEMLISTS=no CONFIG_HEADERS= $(SHELL) ./config.status

DEPFILES := $(wildcard *.d)
ifneq ($(DEPFILES),)
include $(DEPFILES)
endif

install: $(LIBCLICKTOOL) install-local
install-local: all-local
	$(mkinstalldirs) $(DESTDIR)$(bindir)
	$(INSTALL) click2xml $(DESTDIR)$(bindir)/click2xml
	test -z "@XML2CLICK@" || $(INSTALL) xml2click $(DESTDIR)$(bindir)/xml2click
uninstall:
	/bin/rm -f $(DESTDIR)$(bindir)/click2xml
	test -z "@XML2CLICK@" || /bin/rm -f $(DESTDIR)$(bindir)/xml2click

clean:
	rm -f *.d *.o click2xml xml2click
distclean: clean
	-rm -f Makefile

.PHONY: all all-local clean distclean \
	install install-local uninstall $(LIBCLICKTOOL)
