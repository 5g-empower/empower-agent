# Warning: this file must be usable by regular make
# (unlike the Makefiles in subdirectories).

SHELL = @SHELL@
@SUBMAKE@

PACKAGE = @PACKAGE@
VERSION = @VERSION@

top_srcdir = @top_srcdir@
srcdir = @srcdir@
top_builddir = .
subdir = .
AUTOHEADER = @AUTOHEADER@
AUTOCONF = @AUTOCONF@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL@ -m 644
mkinstalldirs = @top_srcdir@/mkinstalldirs

prefix = @prefix@
exec_prefix = @exec_prefix@
includedir = @includedir@/click

all: @TARGETS@ tools Makefile

linuxmodule: Makefile
	@cd linuxmodule && $(MAKE) all
userlevel: Makefile
	@cd userlevel && $(MAKE) all
exopc: Makefile
	@cd exopc && $(MAKE) all
tools: Makefile
	@cd tools && $(MAKE) all

install:
	@-for d in @TARGETS@ tools doc; do (cd $$d && $(MAKE) install); done
	@$(MAKE) install-include
install-doc:
	@cd doc && $(MAKE) install
install-man:
	@-for d in @TARGETS@ tools doc; do (cd $$d && $(MAKE) install-man); done
install-include:
	$(mkinstalldirs) $(includedir)
	$(INSTALL_DATA) $(top_builddir)/config.h $(srcdir)/lib/*.hh $(includedir)

elemlist elemlists:
	$(SHELL) mkelemlist.sh

$(srcdir)/configure: $(srcdir)/configure.in $(srcdir)/acconfig.h
	cd $(srcdir) && $(AUTOHEADER)
	cd $(srcdir) && $(AUTOCONF)
	$(SHELL) $(srcdir)/configure @ac_configure_args@
Makefile: $(srcdir)/configure $(srcdir)/Makefile.in
	cd $(top_builddir) && \
	  CONFIG_FILES=$@ CONFIG_ELEMLISTS=no CONFIG_HEADERS= $(SHELL) ./config.status

check-filenames:
	@a=`find . \( -name \*.cc -or -name \*.c \) -print | sed 's/.*\/\(.*\)\.c*$$/\1.o/' | grep -v 'elements\.o' | sort | uniq -d`; \
	if test -z $$a; then echo OK; else echo "*** warning: duplicate object file names:"; echo "$$a"; fi

clean:
	@-for d in @POSSIBLE_TARGETS@ tools doc; do (cd $$d && $(MAKE) clean); done
distclean:
	@-for d in @POSSIBLE_TARGETS@ tools doc; do (cd $$d && $(MAKE) distclean); done
	-rm -f config.h Makefile config.status
	-rm -f config.cache config.log mkelemlist.sh


DISTFILES = AUTHORS COPYRIGHT FAQ INSTALL LICENSE NEWS README \
	doc/Makefile.in doc/click.1 doc/click.5 doc/click.o.8 \
	doc/click-align.1 doc/click-devirtualize.1 doc/click-fastclassifier.1 \
	doc/click-install.1 doc/click-uninstall.1 doc/click-xform.1 \
	doc/element2man.pl doc/mkelementmap.pl \
	doc/Element.3 doc/Connection.3 \
	conf/make-ip-conf.pl conf/ip.clickpat \
	conf/fake-iprouter.click \
	conf/test.click conf/test2.click conf/test3.click conf/testbpf.click \
	conf/udpgen.click \
	Makefile.in acconfig.h config.h.in configure.in configure \
	install-sh missing mkinstalldirs findelements.sh mkelemlist.sh.in \
	etc/linux-2.2.14-patch \
	lib/archive.cc lib/archive.hh \
	lib/bitvector.cc lib/bitvector.hh \
	lib/click_ether.h \
	lib/click_icmp.h \
	lib/click_ip.h \
	lib/click_tcp.h \
	lib/click_udp.h \
	lib/clickpackage.hh \
	lib/clp.c lib/clp.h \
	lib/confparse.cc lib/confparse.hh \
	lib/crc32.c lib/crc32.h \
	lib/element.cc lib/element.hh \
	lib/elemfilter.cc lib/elemfilter.hh \
	lib/elemlink.cc lib/elemlink.hh \
	lib/error.cc lib/error.hh \
	lib/errorelement.cc lib/errorelement.hh \
	lib/etheraddress.cc lib/etheraddress.hh \
	lib/ewma.cc lib/ewma.hh \
	lib/glue.cc lib/glue.hh \
	lib/hashmap.cc lib/hashmap.hh lib/hashmapi.cc \
	lib/in_cksum.c \
	lib/integers.cc lib/integers.hh \
	lib/ipaddress.cc lib/ipaddress.hh \
	lib/ipflowid.cc lib/ipflowid.hh \
	lib/iptable.cc lib/iptable.hh \
	lib/iptable2.cc lib/iptable2.hh \
	lib/lexer.cc lib/lexer.hh \
	lib/packet.cc lib/packet.hh \
	lib/radix.cc lib/radix.hh \
	lib/router.cc lib/router.hh \
	lib/straccum.cc lib/straccum.hh \
	lib/strerror.c \
	lib/string.cc lib/string.hh \
	lib/subvector.hh \
	lib/timedelement.cc lib/timedelement.hh \
	lib/timer.cc lib/timer.hh \
	lib/vector.cc lib/vector.hh lib/vectori.cc lib/vectorv.cc \
	userlevel/Makefile.in \
	userlevel/click.cc \
	linuxmodule/Makefile.in \
	linuxmodule/kernelerror.cc linuxmodule/kernelerror.hh \
	linuxmodule/kernelversion.c \
	linuxmodule/module.cc \
	linuxmodule/modulepriv.hh \
	linuxmodule/proc_config.cc \
	linuxmodule/proc_element.cc \
	linuxmodule/proc_mgr.cc \
	linuxmodule/read-pmc.c \
	linuxmodule/sched.cc

distdir = $(PACKAGE)-$(VERSION)
top_distdir = $(distdir)

dist: distdir
distdir:
	-rm -rf $(distdir)
	mkdir $(distdir)
	@-chmod 777 $(distdir)
	mkdir $(distdir)/conf $(distdir)/doc $(distdir)/etc $(distdir)/lib $(distdir)/userlevel $(distdir)/linuxmodule
	@-chmod 777 $(distdir)/conf $(distdir)/doc $(distdir)/etc $(distdir)/lib $(distdir)/userlevel $(distdir)/linuxmodule
	@for file in $(DISTFILES); do \
	  d=$(srcdir); \
	  if test -d $$d/$$file; then \
	    cp -pr $$d/$$file $(distdir)/$$file; \
	  else \
	    test -f $(distdir)/$$file \
	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
	    || cp -p $$d/$$file $(distdir)/$$file || :; \
	  fi; \
	done
	mkdir $(distdir)/elements
	@-chmod 777 $(distdir)/elements
	@d=$(srcdir); \
	for dir in `cd $$d && find elements -type d | grep -v 'exopc\|CVS'`; do \
	  mkdir $(distdir)/$$dir 2>/dev/null; \
	  chmod 777 $(distdir)/$$dir; \
	  for cfile in `cd $$d && find $$dir -maxdepth 1 \( -name \[^,.]\*.cc -or -name \[^,.]\*.c -or -name \[^,.]\*.hh -or -name \[^,.]\*.h \) -print`; do \
	    ln $$d/$$cfile $(distdir)/$$cfile; \
	  done; \
	done
	@for subdir in tools; do \
	  (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) top_distdir=../$(distdir) distdir=../$(distdir)/$$subdir distdir) \
	      || exit 1; \
	done


.PHONY: all elemlist elemlists elemlist-simple \
	linuxmodule userlevel exopc tools clean distclean dist distdir \
	install install-man
